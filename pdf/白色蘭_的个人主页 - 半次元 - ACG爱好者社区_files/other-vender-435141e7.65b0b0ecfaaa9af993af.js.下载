(self.webpackChunkfe_banciyuan_web=self.webpackChunkfe_banciyuan_web||[]).push([["other-vender-435141e7"],{"./node_modules/byted-video-uploader/dist/byted_video_uploader.js":function(t){!function(e,r){t.exports=r()}("undefined"!=typeof self&&self,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";var n,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};n=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(t,e){return new Promise(function(r,n){function o(){void 0!==i&&t.removeListener("error",i),r([].slice.call(arguments))}var i;"error"!==e&&(i=function(r){t.removeListener(e,o),n(r)},t.once("error",i)),t.once(e,o)})},(a.EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function f(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function l(t,e,r,n){var o,i;return u(r),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,r.listener||r),o=t._events),i=o[e]),void 0===i?(i=o[e]=r,++t._eventsCount):("function"==typeof i?i=o[e]=n?[r,i]:[i,r]:n?i.unshift(r):i.push(r),0<(r=f(t))&&i.length>r&&!i.warned&&(i.warned=!0,(r=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",r.emitter=t,r.type=e,r.count=i.length,function(t){console&&console.warn&&console.warn(t)}(r))),t}function p(t,e,r){return(e=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(t={fired:!1,wrapFn:void 0,target:t,type:e,listener:r})).listener=r,t.wrapFn=e}function h(t,e,r){return void 0===(t=t._events)?[]:void 0===(e=t[e])?[]:"function"==typeof e?r?[e.listener||e]:[e]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(e):d(e,e.length)}function y(t){var e=this._events;if(void 0!==e){if("function"==typeof(t=e[t]))return 1;if(void 0!==t)return t.length}return 0}function d(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return f(this)},a.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n,o="error"===t,s=this._events;if(void 0!==s)o=o&&void 0===s.error;else if(!o)return!1;if(o){if(0<e.length&&(n=e[0]),n instanceof Error)throw n;throw(o=new Error("Unhandled error."+(n?" ("+n.message+")":""))).context=n,o}if(void 0===(t=s[t]))return!1;if("function"==typeof t)i(t,this,e);else{var a=t.length,c=d(t,a);for(r=0;r<a;++r)i(c[r],this,e)}return!0},a.prototype.addListener=function(t,e){return l(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return l(this,t,e,!0)},a.prototype.once=function(t,e){return u(e),this.on(t,p(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,p(this,t,e)),this},a.prototype.removeListener=function(t,e){var r,n,o,i,s;if(u(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(o=-1,i=r.length-1;0<=i;i--)if(r[i]===e||r[i].listener===e){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,o),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,r=this._events;if(void 0===r)return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){for(var n,o=Object.keys(r),i=0;i<o.length;++i)"removeListener"!==(n=o[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;0<=i;i--)this.removeListener(t,e[i]);return this},a.prototype.listeners=function(t){return h(this,t,!0)},a.prototype.rawListeners=function(t){return h(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):y.call(t,e)},a.prototype.listenerCount=y,a.prototype.eventNames=function(){return 0<this._eventsCount?n(this._events):[]}},function(t,e,r){t.exports=function(){return r(2)('!function(t){var n={};function __webpack_require__(r){if(n[r])return n[r].exports;var e=n[r]={i:r,l:!1,exports:{}};return t[r].call(e.exports,e,e.exports,__webpack_require__),e.l=!0,e.exports}__webpack_require__.m=t,__webpack_require__.c=n,__webpack_require__.d=function(r,e,t){__webpack_require__.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},__webpack_require__.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},__webpack_require__.t=function(e,r){if(1&r&&(e=__webpack_require__(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(__webpack_require__.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)__webpack_require__.d(t,n,function(r){return e[r]}.bind(null,n));return t},__webpack_require__.n=function(r){var e=r&&r.__esModule?function getDefault(){return r.default}:function getModuleExports(){return r};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=9)}([function(r,e,t){r.exports=function(){var r=r||function(h,t){var n=Object.create||function(){function F(){}return function(r){var e;F.prototype=r;e=new F;F.prototype=null;return e}}();var r={};var e=r.lib={};var i=e.Base=function(){return{extend:function(r){var e=n(this);if(r)e.mixIn(r);if(!e.hasOwnProperty("init")||this.init===e.init)e.init=function(){e.$super.init.apply(this,arguments)};e.init.prototype=e;e.$super=this;return e},create:function(){var r=this.extend();r.init.apply(r,arguments);return r},init:function(){},mixIn:function(r){for(var e in r)if(r.hasOwnProperty(e))this[e]=r[e];if(r.hasOwnProperty("toString"))this.toString=r.toString},clone:function(){return this.init.prototype.extend(this)}}}();var p=e.WordArray=i.extend({init:function(r,e){r=this.words=r||[];if(e!=t)this.sigBytes=e;else this.sigBytes=r.length*4},toString:function(r){return(r||o).stringify(this)},concat:function(r){var e=this.words;var t=r.words;var n=this.sigBytes;var i=r.sigBytes;this.clamp();if(n%4)for(var a=0;a<i;a++){var o=t[a>>>2]>>>24-a%4*8&255;e[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var a=0;a<i;a+=4)e[n+a>>>2]=t[a>>>2];this.sigBytes+=i;return this},clamp:function(){var r=this.words;var e=this.sigBytes;r[e>>>2]&=4294967295<<32-e%4*8;r.length=h.ceil(e/4)},clone:function(){var r=i.clone.call(this);r.words=this.words.slice(0);return r},random:function(r){var e=[];var t=function(e){var e=e;var t=987654321;var n=4294967295;return function(){t=36969*(t&65535)+(t>>16)&n;e=18e3*(e&65535)+(e>>16)&n;var r=(t<<16)+e&n;r/=4294967296;r+=.5;return r*(h.random()>.5?1:-1)}};for(var n=0,i;n<r;n+=4){var a=t((i||h.random())*4294967296);i=a()*987654071;e.push(a()*4294967296|0)}return new p.init(e,r)}});var a=r.enc={};var o=a.Hex={stringify:function(r){var e=r.words;var t=r.sigBytes;var n=[];for(var i=0;i<t;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16));n.push((a&15).toString(16))}return n.join("")},parse:function(r){var e=r.length;var t=[];for(var n=0;n<e;n+=2)t[n>>>3]|=parseInt(r.substr(n,2),16)<<24-n%8*4;return new p.init(t,e/2)}};var c=a.Latin1={stringify:function(r){var e=r.words;var t=r.sigBytes;var n=[];for(var i=0;i<t;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(r){var e=r.length;var t=[];for(var n=0;n<e;n++)t[n>>>2]|=(r.charCodeAt(n)&255)<<24-n%4*8;return new p.init(t,e)}};var s=a.Utf8={stringify:function(r){try{return decodeURIComponent(escape(c.stringify(r)))}catch(r){throw new Error("Malformed UTF-8 data")}},parse:function(r){return c.parse(unescape(encodeURIComponent(r)))}};var f=e.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new p.init;this._nDataBytes=0},_append:function(r){if(typeof r=="string")r=s.parse(r);this._data.concat(r);this._nDataBytes+=r.sigBytes},_process:function(r){var e=this._data;var t=e.words;var n=e.sigBytes;var i=this.blockSize;var a=i*4;var o=n/a;if(r)o=h.ceil(o);else o=h.max((o|0)-this._minBufferSize,0);var c=o*i;var s=h.min(c*4,n);if(c){for(var f=0;f<c;f+=i)this._doProcessBlock(t,f);var u=t.splice(0,c);e.sigBytes-=s}return new p.init(u,s)},clone:function(){var r=i.clone.call(this);r._data=this._data.clone();return r},_minBufferSize:0});var u=e.Hasher=f.extend({cfg:i.extend(),init:function(r){this.cfg=this.cfg.extend(r);this.reset()},reset:function(){f.reset.call(this);this._doReset()},update:function(r){this._append(r);this._process();return this},finalize:function(r){if(r)this._append(r);var e=this._doFinalize();return e},blockSize:512/32,_createHelper:function(t){return function(r,e){return new t.init(e).finalize(r)}},_createHmacHelper:function(t){return function(r,e){return new v.HMAC.init(t,e).finalize(r)}}});var v=r.algo={};return r}(Math);return r}()},function(r,e,t){r.exports=function(F){F.lib.Cipher||function(o){var r=F;var e=r.lib;var t=e.Base;var s=e.WordArray;var n=e.BufferedBlockAlgorithm;var i=r.enc;var a=i.Utf8;var c=i.Base64;var f=r.algo;var u=f.EvpKDF;var h=e.Cipher=n.extend({cfg:t.extend(),createEncryptor:function(r,e){return this.create(this._ENC_XFORM_MODE,r,e)},createDecryptor:function(r,e){return this.create(this._DEC_XFORM_MODE,r,e)},init:function(r,e,t){this.cfg=this.cfg.extend(t);this._xformMode=r;this._key=e;this.reset()},reset:function(){n.reset.call(this);this._doReset()},process:function(r){this._append(r);return this._process()},finalize:function(r){if(r)this._append(r);var e=this._doFinalize();return e},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function selectCipherStrategy(r){if(typeof r=="string")return S;else return m}return function(n){return{encrypt:function(r,e,t){return selectCipherStrategy(e).encrypt(n,r,e,t)},decrypt:function(r,e,t){return selectCipherStrategy(e).decrypt(n,r,e,t)}}}}()});var p=e.StreamCipher=h.extend({_doFinalize:function(){var r=this._process(!!"flush");return r},blockSize:1});var v=r.mode={};var _=e.BlockCipherMode=t.extend({createEncryptor:function(r,e){return this.Encryptor.create(r,e)},createDecryptor:function(r,e){return this.Decryptor.create(r,e)},init:function(r,e){this._cipher=r;this._iv=e}});var d=v.CBC=function(){var r=_.extend();r.Encryptor=r.extend({processBlock:function(r,e){var t=this._cipher;var n=t.blockSize;xorBlock.call(this,r,e,n);t.encryptBlock(r,e);this._prevBlock=r.slice(e,e+n)}});r.Decryptor=r.extend({processBlock:function(r,e){var t=this._cipher;var n=t.blockSize;var i=r.slice(e,e+n);t.decryptBlock(r,e);xorBlock.call(this,r,e,n);this._prevBlock=i}});function xorBlock(r,e,t){var n=this._iv;if(n){var i=n;this._iv=o}else var i=this._prevBlock;for(var a=0;a<t;a++)r[e+a]^=i[a]}return r}();var l=r.pad={};var y=l.Pkcs7={pad:function(r,e){var t=e*4;var n=t-r.sigBytes%t;var i=n<<24|n<<16|n<<8|n;var a=[];for(var o=0;o<n;o+=4)a.push(i);var c=s.create(a,n);r.concat(c)},unpad:function(r){var e=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=e}};var g=e.BlockCipher=h.extend({cfg:h.cfg.extend({mode:d,padding:y}),reset:function(){h.reset.call(this);var r=this.cfg;var e=r.iv;var t=r.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else{var n=t.createDecryptor;this._minBufferSize=1}if(this._mode&&this._mode.__creator==n)this._mode.init(this,e&&e.words);else{this._mode=n.call(t,this,e&&e.words);this._mode.__creator=n}},_doProcessBlock:function(r,e){this._mode.processBlock(r,e)},_doFinalize:function(){var r=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){r.pad(this._data,this.blockSize);var e=this._process(!!"flush")}else{var e=this._process(!!"flush");r.unpad(e)}return e},blockSize:128/32});var k=e.CipherParams=t.extend({init:function(r){this.mixIn(r)},toString:function(r){return(r||this.formatter).stringify(this)}});var x=r.format={};var B=x.OpenSSL={stringify:function(r){var e=r.ciphertext;var t=r.salt;if(t)var n=s.create([1398893684,1701076831]).concat(t).concat(e);else var n=e;return n.toString(c)},parse:function(r){var e=c.parse(r);var t=e.words;if(t[0]==1398893684&&t[1]==1701076831){var n=s.create(t.slice(2,4));t.splice(0,4);e.sigBytes-=16}return k.create({ciphertext:e,salt:n})}};var m=e.SerializableCipher=t.extend({cfg:t.extend({format:B}),encrypt:function(r,e,t,n){n=this.cfg.extend(n);var i=r.createEncryptor(t,n);var a=i.finalize(e);var o=i.cfg;return k.create({ciphertext:a,key:t,iv:o.iv,algorithm:r,mode:o.mode,padding:o.padding,blockSize:r.blockSize,formatter:n.format})},decrypt:function(r,e,t,n){n=this.cfg.extend(n);e=this._parse(e,n.format);var i=r.createDecryptor(t,n).finalize(e.ciphertext);return i},_parse:function(r,e){if(typeof r=="string")return e.parse(r,this);else return r}});var b=r.kdf={};var w=b.OpenSSL={execute:function(r,e,t,n){if(!n)n=s.random(64/8);var i=u.create({keySize:e+t}).compute(r,n);var a=s.create(i.words.slice(e),t*4);i.sigBytes=e*4;return k.create({key:i,iv:a,salt:n})}};var S=e.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:w}),encrypt:function(r,e,t,n){n=this.cfg.extend(n);var i=n.kdf.execute(t,r.keySize,r.ivSize);n.iv=i.iv;var a=m.encrypt.call(this,r,e,i.key,n);a.mixIn(i);return a},decrypt:function(r,e,t,n){n=this.cfg.extend(n);e=this._parse(e,n.format);var i=n.kdf.execute(t,r.keySize,r.ivSize,e.salt);n.iv=i.iv;var a=m.decrypt.call(this,r,e,i.key,n);return a}})}()}(t(0),t(5))},function(r,e,t){r.exports=function(n){return function(){var r=n,e=r.lib.BlockCipher,t=r.algo,f=[],u=[],h=[],p=[],v=[],_=[],d=[],l=[],y=[],g=[];!function(){for(var r=[],e=0;e<256;e++)r[e]=e<128?e<<1:e<<1^283;for(var t=0,n=0,e=0;e<256;e++){var i=(i=n^n<<1^n<<2^n<<3^n<<4)>>>8^255&i^99;f[t]=i;var a=r[u[i]=t],o=r[a],c=r[o],s=257*r[i]^16843008*i;h[t]=s<<24|s>>>8,p[t]=s<<16|s>>>16,v[t]=s<<8|s>>>24,_[t]=s;s=16843009*c^65537*o^257*a^16843008*t;d[i]=s<<24|s>>>8,l[i]=s<<16|s>>>16,y[i]=s<<8|s>>>24,g[i]=s,t?(t=a^r[r[r[c^a]]],n^=r[r[n]]):t=n=1}}();var k=[0,1,2,4,8,16,32,64,128,27,54],t=t.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var r=this._keyPriorReset=this._key,e=r.words,t=r.sigBytes/4,n=4*(1+(this._nRounds=6+t)),i=this._keySchedule=[],a=0;a<n;a++)a<t?i[a]=e[a]:(s=i[a-1],a%t?6<t&&a%t==4&&(s=f[s>>>24]<<24|f[s>>>16&255]<<16|f[s>>>8&255]<<8|f[255&s]):(s=f[(s=s<<8|s>>>24)>>>24]<<24|f[s>>>16&255]<<16|f[s>>>8&255]<<8|f[255&s],s^=k[a/t|0]<<24),i[a]=i[a-t]^s);for(var o=this._invKeySchedule=[],c=0;c<n;c++){var s,a=n-c;s=c%4?i[a]:i[a-4],o[c]=c<4||a<=4?s:d[f[s>>>24]]^l[f[s>>>16&255]]^y[f[s>>>8&255]]^g[f[255&s]]}}},encryptBlock:function(r,e){this._doCryptBlock(r,e,this._keySchedule,h,p,v,_,f)},decryptBlock:function(r,e){var t=r[e+1];r[e+1]=r[e+3],r[e+3]=t,this._doCryptBlock(r,e,this._invKeySchedule,d,l,y,g,u);t=r[e+1];r[e+1]=r[e+3],r[e+3]=t},_doCryptBlock:function(r,e,t,n,i,a,o,c){for(var s=this._nRounds,f=r[e]^t[0],u=r[e+1]^t[1],h=r[e+2]^t[2],p=r[e+3]^t[3],v=4,_=1;_<s;_++)var d=n[f>>>24]^i[u>>>16&255]^a[h>>>8&255]^o[255&p]^t[v++],l=n[u>>>24]^i[h>>>16&255]^a[p>>>8&255]^o[255&f]^t[v++],y=n[h>>>24]^i[p>>>16&255]^a[f>>>8&255]^o[255&u]^t[v++],g=n[p>>>24]^i[f>>>16&255]^a[u>>>8&255]^o[255&h]^t[v++],f=d,u=l,h=y,p=g;d=(c[f>>>24]<<24|c[u>>>16&255]<<16|c[h>>>8&255]<<8|c[255&p])^t[v++],l=(c[u>>>24]<<24|c[h>>>16&255]<<16|c[p>>>8&255]<<8|c[255&f])^t[v++],y=(c[h>>>24]<<24|c[p>>>16&255]<<16|c[f>>>8&255]<<8|c[255&u])^t[v++],g=(c[p>>>24]<<24|c[f>>>16&255]<<16|c[u>>>8&255]<<8|c[255&h])^t[v++];r[e]=d,r[e+1]=l,r[e+2]=y,r[e+3]=g},keySize:8});r.AES=e._createHelper(t)}(),n.AES}(t(0),(t(10),t(11),t(5),t(1)))},function(r,e,t){r.exports=function(e){return e.mode.ECB=function(){var r=e.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(r,e){this._cipher.encryptBlock(r,e)}}),r.Decryptor=r.extend({processBlock:function(r,e){this._cipher.decryptBlock(r,e)}}),r}(),e.mode.ECB}(t(0),t(1))},function(r,e,t){r.exports=function(r){return r.enc.Utf8}(t(0))},function(r,e,t){r.exports=function(a){return function(){var r=a,e=r.lib,t=e.Base,u=e.WordArray,n=r.algo,e=n.MD5,i=n.EvpKDF=t.extend({cfg:t.extend({keySize:4,hasher:e,iterations:1}),init:function(r){this.cfg=this.cfg.extend(r)},compute:function(r,e){for(var t=this.cfg,n=t.hasher.create(),i=u.create(),a=i.words,o=t.keySize,c=t.iterations;a.length<o;){s&&n.update(s);var s=n.update(r).finalize(e);n.reset();for(var f=1;f<c;f++)s=n.finalize(s),n.reset();i.concat(s)}return i.sigBytes=4*o,i}});r.EvpKDF=function(r,e,t){return i.create(t).compute(r,e)}}(),a.EvpKDF}(t(0),(t(12),t(13)))},function(r,e,t){r.exports=function(r){return r.pad.Pkcs7}(t(0),t(1))},function(r,e,t){r.exports=function(r){return r.pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding}(t(0),t(1))},function(r,e,t){r.exports=function(e){return function(){var r,i;"function"==typeof ArrayBuffer&&(r=e.lib.WordArray,i=r.init,(r.init=function(r){if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),(r instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&r instanceof Uint8ClampedArray||r instanceof Int16Array||r instanceof Uint16Array||r instanceof Int32Array||r instanceof Uint32Array||r instanceof Float32Array||r instanceof Float64Array)&&(r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength)),r instanceof Uint8Array){for(var e=r.byteLength,t=[],n=0;n<e;n++)t[n>>>2]|=r[n]<<24-n%4*8;i.call(this,t,e)}else i.apply(this,arguments)}).prototype=r)}(),e.lib.WordArray}(t(0))},function(r,e,t){"use strict";t.r(e);var e=t(2),o=t.n(e),e=t(3),c=t.n(e),e=t(6),s=t.n(e),e=t(7),f=t.n(e),e=t(8),u=t.n(e),e=t(4),h=t.n(e);function crc32(r,e){var t=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(t=new Int32Array(t));for(var n=-1^~~e,i=(r=new Uint8Array(r)).length,a=0;a<i;a++)n=t[255&(n^r[a])]^n>>>8;return(-1^n)>>>0}function dec2hex(r){if(void 0!==r)return function toEight(r){return r.length<8?toEight(r="0".concat(r)):r}(Number(r).toString(16))}self.onmessage=function(r){var e,t=r.data,n=t[0],i=t[1],a=t[2],r=t[3],t=t[4];a?(e=u.a.create(n),r=crc32(e=function wordArrayToUint8Array(r){for(var e=r.sigBytes,t=r.words,n=new Uint8Array(e),i=0,a=0;i!==e;){var o=t[a++];if(n[i++]=(4278190080&o)>>>24,i===e)break;if(n[i++]=(16711680&o)>>>16,i===e)break;if(n[i++]=(65280&o)>>>8,i===e)break;n[i++]=255&o}return n}((t&&n.byteLength%16!=0?o.a.encrypt(e,h.a.parse(r),{mode:c.a,padding:s.a}):o.a.encrypt(e,h.a.parse(r),{mode:c.a,padding:f.a})).ciphertext),0),postMessage([e.buffer,dec2hex(r),i],[e.buffer])):(e=crc32(n,0),postMessage([n,dec2hex(e),i],[n]))}},function(r,e,t){r.exports=function(r){return function(){var s=r.lib.WordArray;r.enc.Base64={stringify:function(r){var e=r.words,t=r.sigBytes,n=this._map;r.clamp();for(var i=[],a=0;a<t;a+=3)for(var o=(e[a>>>2]>>>24-a%4*8&255)<<16|(e[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|e[a+2>>>2]>>>24-(a+2)%4*8&255,c=0;c<4&&a+.75*c<t;c++)i.push(n.charAt(o>>>6*(3-c)&63));var s=n.charAt(64);if(s)for(;i.length%4;)i.push(s);return i.join("")},parse:function(r){var e=r.length,t=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<t.length;i++)n[t.charCodeAt(i)]=i}var a=t.charAt(64);return!a||-1!==(a=r.indexOf(a))&&(e=a),function parseLoop(r,e,t){for(var n=[],i=0,a=0;a<e;a++){var o,c;a%4&&(o=t[r.charCodeAt(a-1)]<<a%4*2,c=t[r.charCodeAt(a)]>>>6-a%4*2,n[i>>>2]|=(o|c)<<24-i%4*8,i++)}return s.create(n,i)}(r,e,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64}(t(0))},function(r,e,t){r.exports=function(i){return function(s){var r=i,e=r.lib,t=e.WordArray,n=e.Hasher,e=r.algo,F=[];!function(){for(var r=0;r<64;r++)F[r]=4294967296*s.abs(s.sin(r+1))|0}();e=e.MD5=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(r,e){for(var t=0;t<16;t++){var n=e+t,i=r[n];r[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var a=this._hash.words,o=r[e+0],c=r[e+1],s=r[e+2],f=r[e+3],u=r[e+4],h=r[e+5],p=r[e+6],v=r[e+7],_=r[e+8],d=r[e+9],l=r[e+10],y=r[e+11],g=r[e+12],k=r[e+13],x=r[e+14],B=r[e+15],m=FF(m=a[0],S=a[1],w=a[2],b=a[3],o,7,F[0]),b=FF(b,m,S,w,c,12,F[1]),w=FF(w,b,m,S,s,17,F[2]),S=FF(S,w,b,m,f,22,F[3]);m=FF(m,S,w,b,u,7,F[4]),b=FF(b,m,S,w,h,12,F[5]),w=FF(w,b,m,S,p,17,F[6]),S=FF(S,w,b,m,v,22,F[7]),m=FF(m,S,w,b,_,7,F[8]),b=FF(b,m,S,w,d,12,F[9]),w=FF(w,b,m,S,l,17,F[10]),S=FF(S,w,b,m,y,22,F[11]),m=FF(m,S,w,b,g,7,F[12]),b=FF(b,m,S,w,k,12,F[13]),w=FF(w,b,m,S,x,17,F[14]),m=GG(m,S=FF(S,w,b,m,B,22,F[15]),w,b,c,5,F[16]),b=GG(b,m,S,w,p,9,F[17]),w=GG(w,b,m,S,y,14,F[18]),S=GG(S,w,b,m,o,20,F[19]),m=GG(m,S,w,b,h,5,F[20]),b=GG(b,m,S,w,l,9,F[21]),w=GG(w,b,m,S,B,14,F[22]),S=GG(S,w,b,m,u,20,F[23]),m=GG(m,S,w,b,d,5,F[24]),b=GG(b,m,S,w,x,9,F[25]),w=GG(w,b,m,S,f,14,F[26]),S=GG(S,w,b,m,_,20,F[27]),m=GG(m,S,w,b,k,5,F[28]),b=GG(b,m,S,w,s,9,F[29]),w=GG(w,b,m,S,v,14,F[30]),m=HH(m,S=GG(S,w,b,m,g,20,F[31]),w,b,h,4,F[32]),b=HH(b,m,S,w,_,11,F[33]),w=HH(w,b,m,S,y,16,F[34]),S=HH(S,w,b,m,x,23,F[35]),m=HH(m,S,w,b,c,4,F[36]),b=HH(b,m,S,w,u,11,F[37]),w=HH(w,b,m,S,v,16,F[38]),S=HH(S,w,b,m,l,23,F[39]),m=HH(m,S,w,b,k,4,F[40]),b=HH(b,m,S,w,o,11,F[41]),w=HH(w,b,m,S,f,16,F[42]),S=HH(S,w,b,m,p,23,F[43]),m=HH(m,S,w,b,d,4,F[44]),b=HH(b,m,S,w,g,11,F[45]),w=HH(w,b,m,S,B,16,F[46]),m=II(m,S=HH(S,w,b,m,s,23,F[47]),w,b,o,6,F[48]),b=II(b,m,S,w,v,10,F[49]),w=II(w,b,m,S,x,15,F[50]),S=II(S,w,b,m,h,21,F[51]),m=II(m,S,w,b,g,6,F[52]),b=II(b,m,S,w,f,10,F[53]),w=II(w,b,m,S,l,15,F[54]),S=II(S,w,b,m,c,21,F[55]),m=II(m,S,w,b,_,6,F[56]),b=II(b,m,S,w,B,10,F[57]),w=II(w,b,m,S,p,15,F[58]),S=II(S,w,b,m,k,21,F[59]),m=II(m,S,w,b,u,6,F[60]),b=II(b,m,S,w,y,10,F[61]),w=II(w,b,m,S,s,15,F[62]),S=II(S,w,b,m,d,21,F[63]),a[0]=a[0]+m|0,a[1]=a[1]+S|0,a[2]=a[2]+w|0,a[3]=a[3]+b|0},_doFinalize:function(){var r=this._data,e=r.words,t=8*this._nDataBytes,n=8*r.sigBytes;e[n>>>5]|=128<<24-n%32;var i=s.floor(t/4294967296),t=t;e[15+(64+n>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e[14+(64+n>>>9<<4)]=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8),r.sigBytes=4*(e.length+1),this._process();for(var e=this._hash,a=e.words,o=0;o<4;o++){var c=a[o];a[o]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return e},clone:function(){var r=n.clone.call(this);return r._hash=this._hash.clone(),r}});function FF(r,e,t,n,i,a,o){o=r+(e&t|~e&n)+i+o;return(o<<a|o>>>32-a)+e}function GG(r,e,t,n,i,a,o){o=r+(e&n|t&~n)+i+o;return(o<<a|o>>>32-a)+e}function HH(r,e,t,n,i,a,o){o=r+(e^t^n)+i+o;return(o<<a|o>>>32-a)+e}function II(r,e,t,n,i,a,o){o=r+(t^(e|~n))+i+o;return(o<<a|o>>>32-a)+e}r.MD5=n._createHelper(e),r.HmacMD5=n._createHmacHelper(e)}(Math),i.MD5}(t(0))},function(r,e,t){r.exports=function(i){return function(){var r=i,e=r.lib,t=e.WordArray,n=e.Hasher,e=r.algo,u=[],e=e.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(r,e){for(var t=this._hash.words,n=t[0],i=t[1],a=t[2],o=t[3],c=t[4],s=0;s<80;s++){s<16?u[s]=0|r[e+s]:(f=u[s-3]^u[s-8]^u[s-14]^u[s-16],u[s]=f<<1|f>>>31);var f=(n<<5|n>>>27)+c+u[s];f+=s<20?1518500249+(i&a|~i&o):s<40?1859775393+(i^a^o):s<60?(i&a|i&o|a&o)-1894007588:(i^a^o)-899497514,c=o,o=a,a=i<<30|i>>>2,i=n,n=f}t[0]=t[0]+n|0,t[1]=t[1]+i|0,t[2]=t[2]+a|0,t[3]=t[3]+o|0,t[4]=t[4]+c|0},_doFinalize:function(){var r=this._data,e=r.words,t=8*this._nDataBytes,n=8*r.sigBytes;return e[n>>>5]|=128<<24-n%32,e[14+(64+n>>>9<<4)]=Math.floor(t/4294967296),e[15+(64+n>>>9<<4)]=t,r.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var r=n.clone.call(this);return r._hash=this._hash.clone(),r}});r.SHA1=n._createHelper(e),r.HmacSHA1=n._createHmacHelper(e)}(),i.SHA1}(t(0))},function(r,e,t){r.exports=function(o){(function(){var r=o;var e=r.lib;var t=e.Base;var n=r.enc;var f=n.Utf8;var i=r.algo;var a=i.HMAC=t.extend({init:function(r,e){r=this._hasher=new r.init;if(typeof e=="string")e=f.parse(e);var t=r.blockSize;var n=t*4;if(e.sigBytes>n)e=r.finalize(e);e.clamp();var i=this._oKey=e.clone();var a=this._iKey=e.clone();var o=i.words;var c=a.words;for(var s=0;s<t;s++){o[s]^=1549556828;c[s]^=909522486}i.sigBytes=a.sigBytes=n;this.reset()},reset:function(){var r=this._hasher;r.reset();r.update(this._iKey)},update:function(r){this._hasher.update(r);return this},finalize:function(r){var e=this._hasher;var t=e.finalize(r);e.reset();var n=e.finalize(this._oKey.clone().concat(t));return n}})})()}(t(0))}]);',r.p+"44ae4065fbbf51b5146f.worker.js")}},function(t,e,r){"use strict";var n=window.URL||window.webkitURL;t.exports=function(t,e){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),r=r.getBlob()}catch(e){r=new Blob([t])}return new Worker(n.createObjectURL(r))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(t))}}catch(t){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}},function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return pe});var n=r(0),o=r.n(n),i=atob("aHR0cHM6Ly92YXMtbGYteC5zbnNzZGsuY29t"),s=atob("aHR0cHM6Ly92YXMuc25zc2RrLmNvbQo="),a=(e=atob("aHR0cHM6Ly9sb2cuc25zc2RrLmNvbQ=="),n="3413ace7e2a9a235a9d5807ad78d9bac",{debug:!1,isBOE:!1,encrypt:!1,noLog:!1,noMeta:!1,getUploadAddressUrl:"{vasDomain}/video/openapi/v1/?action=GetVideoUploadParams",getVideoInfoUrl:"{vasDomain}/video/openapi/v1/?action=UpdateVideoUploadInfos",getUploadImageAddressUrl:"{vasDomain}/video/openapi/v1/?action=GetImageUploadParams",getImageInfoUrl:"{vasDomain}/video/openapi/v1/?action=GetImageUploadInfos",getEncryptInfoUrl:"{vasDomain}/video/openapi/v1/?action=UpdateObjectUploadInfos",getUploadEncryptUrl:"{vasDomain}/video/openapi/v1/?action=GetObjectUploadParams",getObjectWithObjectKey:"{vasDomain}/video/openapi/v1/?action=GetObjectBatchUploadParamsWithObjectKey",uploadLogUrl:"{logDomain}/video/v1/direct_transfer/?name=upload_jssdk_app_log",initUploadFileUrl:"{tosDomain}/{oid}?uploads",uploadChunkedUrl:"{tosDomain}/{oid}?partNumber={number}&uploadID={uploadId}",uploadMergeUrl:"{tosDomain}/{oid}?uploadID={uploadId}",getUploadListUrl:"{tosDomain}/{oid}?uploadID={uploadId}",directUploadFileUrl:"{tosDomain}/{oid}",topDomain:atob("LmJvZS1nYXRld2F5LmJ5dGVkLm9yZw=="),vasDomain:i,vasBackupDomain:s,logDomain:e,department:n,coverTime:0,isExactCover:!1,external:{},getSliceFunc:null,uploadSliceCount:5,retryUploadTime:3,retryProcess:!0,retryProcessTime:3,retryTaskTime:3,maxProcessPause:20,schema:"https",log:{external:{},category_name:n,user_id:"",video_id:"",upload_video_url:"",upload_id:"",type:"",stage:"",video_size:0,part_count:0,slice_index:0,extra:{},msg:""},replace:{vasDomain:i,logDomain:e,department:n}}),c={browserError:1e3,crc32:1e3,preUpload:1001,initUploadID:1002,process:1003,fileMerge:1004,complete:1005},u="image",f="video",l="object",p={success:0,error:1,cancel:2,pause:2},h=2097152,y={urlTemplate:function(t,e){var r;return e=e||{},Object.keys(e).forEach(function(n){r=new RegExp("{".concat(n,"}"),"g"),t=t.replace(r,e[n])}),t},supportChunked:function(){var t=window.Blob||window.WebKitBlob;try{var e=t.prototype;return!(!FormData||!(e.slice||e.webkitSlice||e.mozSlice))}catch(t){return!1}},supportXhr:function(){return!!window.FormData||window.ProgressEvent&&window.FileReader},supportCrc32:function(){var t=window.FileReader&&window.FileReader.prototype.readAsBinaryString;return"undefined"!=typeof Int32Array&&t&&(blob.slice||blob.webkitSlice||blob.mozSlice)},storage:function(t){var e=t;t={removeItem:function(t){delete e.cache[t]},setItem:function(t,r){e.cache[t]=r},getItem:function(t){return e.cache[t]},clear:function(){delete e.cache,e.cache={}}};try{if(window.localStorage)return window.localStorage.setItem("",""),window.localStorage}catch(e){return t}return t},noop:function(){},getUnique:function(t){return"".concat(t,"_").concat((new Date).getTime(),"_").concat(parseInt(1e6*Math.random()))},getFileSliceLength:function(t,e){var r=t.size,n=1048576;return e&&"function"==typeof e?e(r)<h?h:e(r)||r:200*n<r?10*n:r<=200*n&&2*n<=r?5*n:t.size},generateKey:function(t){for(var e="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,o=0;o<t;o++)e+=r.charAt(Math.floor(Math.random()*n));return e}};function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=g(t);return function(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=g(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=t.call(this)).xhr=new XMLHttpRequest,r._data=null,r}return function(t,e,r){e&&m(t.prototype,e),r&&m(t,r)}(e,[{key:"_ajax",value:function(t){var e=this,r=this.xhr;r.upload.onprogress=function(t){e.emit("progress",t)},r.onreadystatechange=function(n){4===r.readyState&&(r.upload.onprogress=y.noop,r.onreadystatechange=y.noop,r.params=t,e._data&&e._data.url&&(r.currentUrl=e._data.url),200<=r.status&&r.status<300?e.emit("complete",r):400<=r.status&&e.emit("error",r))},r.onerror=function(){r.errText="unknow net error",e.emit("error",r)},r.ontimeout=function(){r.errText="timeout",e.emit("error",r)},r.onabort=function(){r.errText="abort",e.emit("error",r)},r.send(t)}},{key:"send",value:function(t){var e=this;return this._data=t,this.xhr.open(t.method||"POST",t.url||"",!0),t.headers&&Object.keys(t.headers).forEach(function(r){e.xhr.setRequestHeader(r,t.headers[r])}),this.xhr.timeout=t.timeout||0,t.ontimeout&&(this.xhr.ontimeout=t.ontimeout),t.binary?this.sendAsBinary(t):t.custom?"object"===d(t.custom)?this.sendAsCustom(JSON.stringify(t.custom)):this.sendAsCustom(t.custom):this.sendAsFormData(t)}},{key:"sendAsBinary",value:function(t){return this.xhr.setRequestHeader("Content-Type","application/octet-stream"),this.xhr.setRequestHeader("Content-Disposition",'attachment; filename="'.concat(encodeURI(t.filename),'"')),this._ajax(t.file)}},{key:"sendAsFormData",value:function(t){var e;t.formData&&(e="function"==typeof t.formData?t.formData():t.formData),e=e||[];for(var r=new FormData,n=0,o=e.length;n<o;n++){var i=r[n];r.append(i.name,i.value)}return t.file&&r.append(t.field,t.file,t.name),this._ajax(r)}},{key:"sendAsCustom",value:function(t){return this._ajax(t)}},{key:"abort",value:function(){this.xhr.onreadystatechange=y.noop,this.xhr.abort()}},{key:"getResponse",value:function(){return this.xhr.response}},{key:"getText",value:function(){return this.xhr.responseText}},{key:"getJson",value:function(){return JSON.parse(this.xhr.responseText)}}]),e}();function _(){return(_=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=e,this.context=r}return function(t,e,r){e&&k(t.prototype,e),r&&k(t,r)}(t,[{key:"set",value:function(t){this.options=_(this.options,t)}},{key:"send",value:function(t){var e,r,n,o;this.options&&!this.options.noLog&&(e=this.buildLog(t),this.console(e),t=y.urlTemplate(this.options.uploadLogUrl,this.options.replace),r=this.context,n=this.key,o=r.tasks[n],this.transport=new b,this.transport.on("error",function(t){!t.status&&n&&(o.logError=1,r._saveTask(n))}),this.transport.send({method:"post",url:t,headers:{"Content-Type":"application/json","X-TT-Access":this.options.department,Authorization:o.proxyAuth||""},custom:e}))}},{key:"buildLog",value:function(t){t.key&&(this.key=t.key);var e=_({},this.options.log,t),r={sdk_version:"4.6.1",dep:e.category_name,uid:e.user_id,vid:e.vid,oid:e.oid,req:e.req,res:e.res,start_time:Math.round(e.stageStartTime/1e3)||0,end_time:Math.round(e.stageEndTime/1e3)||0,duration:e.duration,ts:Math.round(Date.now()/1e3),stage:c[e.stage],status:p[e.type],file_size:e.fileSize?Math.round(e.fileSize):0,slice_size:e.sliceLength?Math.round(e.sliceLength):0,msg:e.extra?e.extra.message:"",extra:_({is_break:e.is_break})};return r.stage!==c.process||t.isDirect?r.stage!==c.fileMerge&&!t.isDirect||(r.speed=Math.round(e.speed)):(r.slice_index=e.slice_index,t=e.crc32Array[r.slice_index],r.speed=Math.round(t?t.speed:0)),r.status!==p.error?r:_({},r,{req:e.req,res:e.res})}},{key:"console",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){window.console&&this.options.debug&&console.log(t)})}]),t}();function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function S(){return(S=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var C=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=T(t);return function(t,e){return!e||"object"!==x(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=T(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=t.call(this)).options=r,o.config=n,o.uploaderCtx=r.context,o.currFileCtx=r.context.tasks[r.key],o.retryTime=n.retryTaskTime||3,o.hasRetryTime=0,o}return function(t,e,r){e&&P(t.prototype,e),r&&P(t,r)}(e,[{key:"start",value:function(t,e,r){this.failProcess=r,this.successProcess=e,this._st=Date.now(),(e=(e=this.uploaderCtx._getCache(this.currFileCtx.crc32Key))?JSON.parse(e):{}).vid&&e.uploadID?this.resumeFromCache(e):this.startPreUpload()}},{key:"startPreUpload",value:function(){var t=this,e=new b;e.on("complete",function(e){if(e.response)try{var r,n,o=JSON.parse(e.response);2e3===o.code?(n=(r=o.data&&o.data.edge_nodes&&o.data.edge_nodes.length?o.data.edge_nodes[0]:o.data||{}).tos_up_hosts&&r.tos_up_hosts.length?r.tos_up_hosts[0]:r.tos_host,n=S(t.currFileCtx,r,{useBackupDomain:t.uploaderCtx.useBackupDomain,signature:r.tos_sign,type:"success",extra:{message:"prepare upload success"},stage:"preUpload",oid:Array.isArray(r.object_ids)?r.object_ids[0]:r.oid,tosDomain:"".concat(t.config.schema,"://").concat(n),xhr:e,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st}),t.successProcess&&t.successProcess(n)):t.fail({error:"fail! result.code: ".concat(o.code),errorCode:o.code,message:"prepare upload error: ".concat(o.message),xhr:e})}catch(r){t.fail({error:"catch error: ".concat(JSON.stringify(r)),xhr:e})}else t.fail({error:"request fail: ".concat(e.statusText||e.errText||"UNKNOWN"),xhr:e})}),e.on("error",function(e){t.uploaderCtx.useBackupDomain?t.fail({error:"request fail: ".concat(e.statusText||e.errText||"UNKNOWN"),xhr:e}):(t.hasRetryTime<t.retryTime-1?t.hasRetryTime++:t.uploaderCtx.useBackupDomain=!0,t.startPreUpload())}),this.uploaderCtx.useBackupDomain&&(this.config.replace.vasDomain=this.config.vasBackupDomain);var r=y.urlTemplate(this.options.type===u?this.config.getUploadImageAddressUrl:this.config.getUploadAddressUrl,this.config.replace),n="".concat(r,"&s=").concat(Math.random().toString(36).substr(2),"&use_edge_node=1&file_size=").concat(this.currFileCtx.fileSize);this.options.preUploadUriParams&&Object.keys(this.options.preUploadUriParams).forEach(function(e){n+="&".concat(e,"=").concat(t.options.preUploadUriParams[e])}),this.config.storeRegion&&(n+="&store_region=".concat(this.config.storeRegion)),this.config.enoid&&this.options.type===f&&(n+="&enoid=1"),r={method:"get",url:n,headers:{"Content-Type":"application/json","X-TT-Access":this.config.department,Authorization:this.currFileCtx.proxyAuth,"Cache-Control":"no-cache, no-store, must-revalidate"},timeout:3e4},e.send(r)}},{key:"resumeFromCache",value:function(t){var e=this,r=this.options.key,n=new b;n.on("complete",function(n){try{var o,i=JSON.parse(n.response);0===i.success&&0<i.payload.partList.length?(o=e.confirmCache(i.payload.partList),i=t.hasMerge?5:o.isAllFinished?4:3,o=S(e.currFileCtx,t,{key:r,xhr:n,proxyAuth:e.options.auth,extra:{message:"prepare upload from cache success"},stage:"preUpload",type:"success",percent:0,cacheTask:i,currentTask:1,status:1,isBreak:1,crc32Array:o.crc32Array,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st}),e.successProcess&&e.successProcess(o)):e.startPreUpload()}catch(n){e.startPreUpload()}}),n.on("error",function(t){400<=t.status?e.startPreUpload():e.fail({error:"request error",xhr:t})});var o=this.config.user_id;n.send({method:"get",url:y.urlTemplate(this.config.getUploadListUrl,{tosDomain:t.tosDomain,oid:t.oid,uploadId:t.uploadID}),headers:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?O(Object(r),!0).forEach(function(e){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({Authorization:t.signature,"X-Storage-U":o},t.tos_headers),timeout:3e4})}},{key:"confirmCache",value:function(t){var e=this.currFileCtx.crc32Array,r={};t.forEach(function(t){void 0===r[t.partNumber-1]&&(r[t.partNumber-1]={tag:!0,crc32:t.crc32})});var n=!0;e=e.map(function(t,e){return r[e]&&r[e].tag&&r[e].crc32?(t.crc32=r[e].crc32,t.finished=!0,t.loaded=t.end-t.start):n=!1,t});return{isAllFinished:n,crc32Array:e}}},{key:"fail",value:function(t){var e=t.xhr,r=t.errorCode||"",n="prepare upload error: UNKNOWN";e&&(n=0===e.status?"prepare upload error: NETERROR":t.message||"prepare upload error: ".concat(e.status)),e=S(this.currFileCtx,{extra:{message:n,error:t.error,errorCode:r},type:"error",stage:"preUpload",xhr:e,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st}),this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(e)}}]),e}();function D(t){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function E(){return(E=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function R(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function U(t){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var I=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=U(t);return function(t,e){return!e||"object"!==D(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=U(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=t.call(this)).options=r,o.config=n,o.uploaderCtx=r.context,o.currFileCtx=r.context.tasks[r.key],o.retryTime=n.retryTaskTime||3,o.hasRetryTime=0,o}return function(t,e,r){e&&R(t.prototype,e),r&&R(t,r)}(e,[{key:"start",value:function(t,e,r){this.failProcess=r,this.successProcess=e,this._st=Date.now(),(e=(e=this.uploaderCtx._getCache(this.currFileCtx.crc32Key))?JSON.parse(e):{}).vid&&e.uploadID?this.resumeFromCache(e):this.startPreUpload()}},{key:"startPreUpload",value:function(){var t=this,e=new b;e.on("complete",function(e){if(e.response)try{var r,n,o=JSON.parse(e.response);2e3===o.code?(n=(r=(n=o.data&&Array.isArray(o.data)?o.data[0]:o.data)&&n.edge?n.edge:n.centre||{}).tos_hosts&&r.tos_hosts.length?r.tos_hosts[0]:r.tos_host,r.oid=r.object_id,n=E(t.currFileCtx,r,{signature:r.tos_sign,type:"success",extra:{message:"encrypt prepare upload success"},stage:"preUpload",oid:Array.isArray(r.object_ids)?r.object_ids[0]:r.oid,tosDomain:"".concat(t.config.schema,"://").concat(n),xhr:e,proxyAuth:t.options.auth,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st}),t.successProcess&&t.successProcess(n)):t.fail({error:"fail! result.code: ".concat(o.code),errorCode:o.code,message:"encrypt prepare upload error: ".concat(o.message),xhr:e})}catch(r){t.fail({error:"response parse error: ".concat(JSON.stringify(r)),xhr:e})}else t.fail({error:"request fail: ".concat(e.statusText||e.errText),xhr:e})}),e.on("error",function(e){t.uploaderCtx.useBackupDomain?t.fail({error:"request fail: ".concat(e.statusText||e.errText||"UNKNOWN"),xhr:e}):(t.hasRetryTime<t.retryTime-1?t.hasRetryTime++:t.uploaderCtx.useBackupDomain=!0,t.startPreUpload())}),this.uploaderCtx.useBackupDomain&&(this.config.replace.vasDomain=this.config.vasBackupDomain);var r=this.options.type||f,n=this.options.objectKey,o=n?y.urlTemplate(this.config.getObjectWithObjectKey,this.config.replace):y.urlTemplate(this.config.getUploadEncryptUrl,this.config.replace);r="".concat(o,"&object_type=").concat(r,"&s=").concat(Math.random().toString(36).substr(2),"&file_size=").concat(this.currFileCtx.fileSize,"&use_edge_node=1");n&&"object"===this.options.type&&(r+="&object_keys=".concat(n)),e.send({method:"get",url:r,headers:{"Content-Type":"application/json","X-TT-Access":this.config.department,Authorization:this.currFileCtx.proxyAuth,"Cache-Control":"no-cache, no-store, must-revalidate"},timeout:3e4})}},{key:"resumeFromCache",value:function(t){var e=this,r=this.options.key,n=new b;n.on("complete",function(n){try{var o,i=JSON.parse(n.response);0===i.success&&0<i.payload.partList.length?(o=e.confirmCache(i.payload.partList),i=t.hasMerge?5:o.isAllFinished?4:3,o=E(e.currFileCtx,t,{key:r,xhr:n,extra:{message:"encrypt prepare upload from cache success"},stage:"preUpload",type:"success",percent:0,cacheTask:i,currentTask:1,status:1,isBreak:1,crc32Array:o.crc32Array,stageStartTime:e._st,stageEndTime:Date.now(),duration:Date.now()-e._st}),e.successProcess&&e.successProcess(o)):e.startPreUpload()}catch(n){e.startPreUpload()}}),n.on("error",function(t){400<=t.status?e.startPreUpload():e.fail(t)});var o=this.config.user_id;n.send({method:"get",url:y.urlTemplate(this.config.getUploadListUrl,{tosDomain:t.tosDomain,oid:t.oid,uploadId:t.uploadID}),headers:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?F(Object(r),!0).forEach(function(e){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({Authorization:t.signature,"X-Storage-U":o},t.tos_headers),timeout:3e4})}},{key:"confirmCache",value:function(t){var e=this.currFileCtx.crc32Array,r={};t.forEach(function(t){void 0===r[t.partNumber]&&(r[t.partNumber]=!0)});var n=!0;e=e.map(function(t,e){return r[e]?(t.finished=!0,t.loaded=t.end-t.start):n=!1,t});return{isAllFinished:n,crc32Array:e}}},{key:"fail",value:function(t){var e=t.xhr,r=t.errorCode||"",n="encrypt prepare upload error: UNKNOWN";e&&(n=0===e.status?"encrypt prepare upload error: NETERROR":t.message||"encrypt prepare upload error: ".concat(e.status)),t=E(this.currFileCtx,{extra:{message:n,error:t.error,errorCode:r},type:"error",stage:"preUpload",xhr:t.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st}),this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(t)}}]),e}();function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(){return(B=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function L(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function M(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function N(t,e){return(N=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var q=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&N(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=H(t);return function(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=H(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=t.call(this)).options=r,o.config=n,o.transport=new b,o.uploaderCtx=r.context,o.currFileCtx=r.context.tasks[r.key],o.eventInit(),o}return function(t,e,r){e&&M(t.prototype,e),r&&M(t,r)}(e,[{key:"initUpload",value:function(){var t=this.options.context,e=this.options.key,r={oid:t.tasks[e].oid,tosDomain:t.tasks[e].tosDomain},n=y.urlTemplate(this.config.initUploadFileUrl,r);r=this.config.user_id;this.transport.send({method:"post",url:n,headers:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?L(Object(r),!0).forEach(function(e){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({Authorization:t.tasks[e].signature,"X-Storage-U":r},this.currFileCtx.tos_headers),timeout:3e4})}},{key:"start",value:function(t,e,r){this.successProcess=e,this.failProcess=r,this._st=Date.now(),this.initUpload()}},{key:"eventInit",value:function(){var t=this,e=this.options.context,r=this.options.key;this.transport.on("complete",function(n){try{var o,i=JSON.parse(n.response),s=i.payload.uploadID;0===i.success&&s?(o=B(e.tasks[r],{uploadID:s,percent:0,type:"success",extra:{message:"init upload id success"},stage:"initUploadID",xhr:n,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st}),t.successProcess(o)):t.fail({error:"fail! res.success: ".concat(i.success,", uploadId:").concat(s),xhr:n})}catch(o){t.fail({error:"catch error: ".concat(JSON.stringify(o)),xhr:n})}}),this.transport.on("error",function(e){t.fail({error:"request fail: ".concat(e.statusText||e.errText||"UNKNOWN"),xhr:e})})}},{key:"fail",value:function(t){var e=this.options.context,r=this.options.key;t=B(e.tasks[r],{extra:{message:"init upload id error, ".concat(t.error)},type:"error",stage:"initUploadID",xhr:t.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st});this.uploaderCtx._removeTaskCache(this.options.key),this.failProcess(t)}}]),e}();function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function W(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function J(t,e){return(J=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var V=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&J(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=X(t);return function(t,e){return!e||"object"!==K(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=X(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r){var n,o=r.sliceItem,i=r.crc32,s=r.url,a=r.taskInfor,c=r.userId,u=void 0===(n=r.retryTime)?0:n;r=void 0===(n=r.method)?"put":n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=t.call(this)).fileSlice=o,n.crc32=i,n.uploadUrl=s,n.taskInfor=a,n.userId=c,n.retryTime=u,n.method=r,n.retryCount=0,n.ready=!1,n.cancel=!1,n.transport=new b,n.eventInit(),n}return function(t,e,r){e&&W(t.prototype,e),r&&W(t,r)}(e,[{key:"upload",value:function(){this.isParamsValid()&&(this._st=Date.now(),this.transport.send({method:this.method,url:this.uploadUrl,headers:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?G(Object(r),!0).forEach(function(e){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({Authorization:this.taskInfor.signature,"Content-CRC32":this.crc32,"X-Storage-U":this.userId},this.taskInfor.tos_headers),file:this.fileSlice,binary:1,timeout:18e5}))}},{key:"isParamsValid",value:function(){return this.fileSlice&&(this.fileSlice.size||this.fileSlice.byteLength)?this.crc32?!!this.uploadUrl||(this.emit("error",{message:"slice upload failed: NOURL",crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength}),!1):(this.emit("error",{message:"slice upload failed: NOCRC32",crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength}),!1):(this.emit("error",{message:"slice upload failed: NOCONTENT",crc32:this.crc32}),!1)}},{key:"eventInit",value:function(){var t=this;this.transport.on("complete",function(e){t.success(e)}),this.transport.on("error",function(e){t.fail(e)}),this.transport.on("progress",function(e){t.process(e)})}},{key:"success",value:function(t){this.ready=!0;var e=Date.now()-this._st,r=this.fileSlice.size||this.fileSlice.byteLength;e=r/e;this.emit("complete",{crc32:this.crc32,size:r,speed:e,xhr:t,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st})}},{key:"fail",value:function(t){var e=this;if(!this.cancel)if(t&&401===t.status)this.emit("error",{message:"slice upload failed: UNAUTHORIZED",crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength,xhr:t,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st});else{if(this.retryCount<this.retryTime)return setTimeout(function(){e.upload()},1e3),void this.retryCount++;var r="slice upload failed: UNKNOWN";t&&(r=t.status?"slice upload failed: ".concat(t.status):"slice upload failed: NETERROR"),this.emit("error",{message:r,crc32:this.crc32,size:this.fileSlice.size||this.fileSlice.byteLength,xhr:t,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st})}}},{key:"process",value:function(t){this.cancel||this.emit("process",{crc32:this.crc32,loaded:t.loaded||0,total:t.total||0})}},{key:"abort",value:function(){this.transport&&(this.cancel=!0,this.transport.abort())}},{key:"destroy",value:function(){this.transport=null}}]),e}(),Y=(n=r(1),r.n(n));function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Q(){return(Q=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function $(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tt(t,e){return(tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function et(t){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var rt=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tt(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=et(t);return function(t,e){return!e||"object"!==Z(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=et(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r){var n,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=t.call(this)).file=r.file,n.context=r.context,n.key=r.key,n.config=o,n.finishArr=[],n.errorLength=0,n.finishSize=0,n.retryUploadTime=Number(o.retryUploadTime)||5,n.retryProcess=o.retryProcess,n.retryProcessTime=Number(o.retryProcessTime)||5,n.maxProcessPause=Number(o.maxProcessPause)||20,n.uploadSliceCount=Number(o.uploadSliceCount)||5,n.realtimeSpeedInterval=Number(o.realtimeSpeedInterval)||5,n.processRetry=0,n.lastFinishSize=-1,n.lastProcessPercent=-1,n.lastIntervalSize=-1,n.lastCalculateSpeedTime=-1,n.lastCalculateSpeedSize=0,n.uploadHandlers={},n}return function(t,e,r){e&&$(t.prototype,e),r&&$(t,r)}(e,[{key:"start",value:function(t,e,r){this.failProcess=r,this.successProcess=e,this.errorLength=0,this.currentCtx=this.context.tasks[this.key],this.crc32Array=this.context.tasks[this.key].crc32Array,this.uploadSliceCount=this.uploadSliceCount>this.crc32Array.length?this.crc32Array.length:this.uploadSliceCount,this.lastIndex=0,this.uploading=[],this._uploadSize=this.crc32Array.reduce(function(t,e){return t+(e.finished?0:e.end-e.start)},0),this.currentCtx.startUploadTime=(new Date).getTime(),this._st=Date.now(),this.lastCalculateSpeedTime=this._st,this.readyToUpload=[],this.retryProcess,this.initWorker(),this.threadUpload()}},{key:"initWorker",value:function(){var t,e=this;this.worker||(t=this.crc32Array,this.worker=new Y.a,this.worker.onmessage=function(r){var n=r.data[0],o=r.data[2],i=t[o];i.crc32=r.data[1],e.upload(i,n,o)})}},{key:"read",value:function(t,e){var r=this,n=this.file,o=n.slice||n.webkitSlice||n.mozSlice,i=new FileReader;i.onload=function(t){r.worker.postMessage([t.target.result,e,!!r.config.clientEncrypt,r.currentCtx.clientEncryptKey,r.crc32Array.length-1===e],[t.target.result])},i.onerror=function(){r.stop(),r.fail({extra:{message:"An error occurred reading the file",errorCode:1003003}})},i.readAsArrayBuffer(o.call(n,t.start,t.end))}},{key:"threadUpload",value:function(){if(this.uploading.length<this.uploadSliceCount){var t=this.lastIndex,e=this.crc32Array[t];if(e){if(e.finished){if(-1===this.finishArr.indexOf(e.start)&&(this.finishArr.push(e.start),this.finishArr.length>=this.crc32Array.length))return this.stop(),void this.success()}else e.loaded=0,this.uploading.push(t),this.read(e,t);this.lastIndex++,this.threadUpload()}}}},{key:"stop",value:function(){var t=this;Object.keys(this.uploadHandlers).forEach(function(e){t.uploadHandlers[e].abort()}),this.worker&&this.worker.terminate(),this.worker=null,this.clearMonitor()}},{key:"setProgressMonitor",value:function(){var t=this;this.progressMonitorInterval=setInterval(function(){var e,r=t.finishSize;r-t.lastIntervalSize<1024*+t.maxProcessPause&&1===t.currentCtx.status?t.processRetry<t.retryProcessTime?(Object.keys(t.uploadHandlers).forEach(function(e){t.uploadHandlers[e].abort()}),e=t.uploading[0],t.uploading.forEach(function(t){t<e&&(e=t)}),t.processRetry++,t.lastIndex=e,t.uploading=[],t.uploadHandlers={},t.threadUpload(),t.lastIntervalSize=t.crc32Array.reduce(function(t,e){return t+(e.finished?e.end-e.start:0)},0)):t.fail({extra:{message:"percent are not updated in ".concat(t.maxProcessPause," seconds")},statusCode:0}):(t.lastIntervalSize=r,t.processRetry=0)},1e3*this.maxProcessPause)}},{key:"clearMonitor",value:function(){this.progressMonitorInterval&&clearInterval(this.progressMonitorInterval)}},{key:"upload",value:function(t,e,r){var n=this,o=t.crc32;this.context._saveTask(this.key,{crc32Array:this.crc32Array});var i={number:r+1,uploadId:this.currentCtx.uploadID,oid:this.currentCtx.oid,tosDomain:this.currentCtx.tosDomain},s=y.urlTemplate(this.config.uploadChunkedUrl,i),a=this.currentCtx,c=this.config.user_id;i=this.config.uploadMethod||"put";(i=new V({sliceItem:e,crc32:o,url:s,taskInfor:a,userId:c,retryTime:this.retryUploadTime,method:i})).on("complete",function(e){1===n.currentCtx.status&&(e.start=t.start,e.index=r,n.fileSliceSuccess(e))}),i.on("error",function(e){1===n.currentCtx.status&&(e.start=t.start,e.index=r,n.fail(e))}),i.on("process",function(e){1===n.currentCtx.status&&(e.start=t.start,e.index=r,n.process(e))}),i.upload(),this.uploadHandlers[r]=i}},{key:"success",value:function(t){this.finishArr=[];var e=Date.now()-this._st;e=this._uploadSize/e,t=Q(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"upload all success"},speed:e,xhr:t,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st});this.worker&&this.worker.terminate(),this.successProcess(t)}},{key:"fail",value:function(t){var e,r=Q(this.currentCtx,{extra:t.crc32?{message:t.message,data:t.crc32,size:t.size}:t.extra,type:"error",stage:"process",req:{},res:{},stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st});t.xhr&&(e=t.xhr,r.req={url:t.xhr.currentUrl},r.res={status:e.status,body:e.responseText,header:e.getAllResponseHeaders()},delete t.xhr),void 0!==t.statusCode&&Q(this.currentCtx,{statusCode:t.statusCode}),this.errorLength||(t=t.index,this.context.logger.send(Q({},r,{slice_index:t})),this.stop(),this.context._broadcast("error",r),this.currentCtx.isBreak?this.context._cancel(this.key):this.context._pause(this.key),this.errorLength++)}},{key:"fileSliceSuccess",value:function(t){var e=t.index;-1===this.finishArr.indexOf(t.start)&&this.finishArr.push(t.start),this.crc32Array[e].finished=!0,this.crc32Array[e].speed=t.speed;var r,n={message:"slice upload success"};if(t.xhr&&(r=t.xhr,n.currentUrl=r.currentUrl||"",Q(this.currentCtx,{statusCode:r.status,response:r.responseText,responseHeader:r.getAllResponseHeaders(),xhrParams:{size:r.params&&r.params.size?r.params.size:0}}),delete t.xhr),this.context.logger.send(Q(this.currentCtx,{stage:"process",type:"success",slice_index:e,extra:n,stageStartTime:t.stageStartTime,stageEndTime:t.stageEndTime,duration:t.duration})),this.context._saveTask(this.key),this.finishArr.length>=this.crc32Array.length)return this.stop(),void this.success(t.xhr);this.uploading.splice(this.uploading.indexOf(e),1),this.uploadHandlers[e]&&delete this.uploadHandlers[e],this.threadUpload()}},{key:"getFinishSize",value:function(t,e){var r=e.crc32,n=0;return t.forEach(function(t){t.crc32===r?(t.loaded=e.loaded,n+=e.loaded):(t.loaded||(t.loaded=0),n+=t.loaded)}),n}},{key:"process",value:function(t){var e,r,n=this.currentCtx.realtimeSpeed||0,o=this.currentCtx.fileSize;this.finishSize=this.getFinishSize(this.crc32Array,t),this.finishSize>this.lastFinishSize&&((e=new Date).getTime()-this.lastCalculateSpeedTime>1e3*this.realtimeSpeedInterval&&(r=e.getTime()-this.lastCalculateSpeedTime,t=this.finishSize-this.lastCalculateSpeedSize,n=Math.floor(t/r),this.lastCalculateSpeedTime=e.getTime(),this.lastCalculateSpeedSize=this.finishSize),this.lastFinishSize=this.finishSize),o=Math.floor(this.finishSize/o*100*100)/100||0,n=Q(this.currentCtx,{stage:"process",percent:o,realtimeSpeed:n}),o>this.lastProcessPercent&&100!==o&&(this.lastProcessPercent=o,this.context._broadcast("process",n))}}]),e}();function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ot(){return(ot=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function st(t,e){return(st=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function at(t){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ct=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&st(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=at(t);return function(t,e){return!e||"object"!==nt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=at(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r){var n,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=t.call(this)).options=r,n.file=r.file,n.context=r.context,n.key=r.key,n.config=o,n.finishArr=[],n.errorLength=0,n.finishSize=0,n.retryUploadTime=Number(o.retryUploadTime)||5,n.processRetry=0,n.lastFinishSize=-1,n.lastProcessPercent=-1,n.lastIntervalSize=-1,n.uploadHandlers=[],n}return function(t,e,r){e&&it(t.prototype,e),r&&it(t,r)}(e,[{key:"start",value:function(t,e,r){this.failProcess=r,this.successProcess=e,this.currentCtx=this.context.tasks[this.key],this.crc32Array=this.context.tasks[this.key].crc32Array,this._uploadSize=this.file.size,this._st=Date.now(),this.upload()}},{key:"upload",value:function(){var t=this,e=(s=this.crc32Array[0]).buffer,r=s.crc32,n={oid:this.currentCtx.oid,tosDomain:this.currentCtx.tosDomain},o=y.urlTemplate(this.config.directUploadFileUrl,n),i=this.currentCtx,s=this.config.user_id;n=this.config.uploadMethod||"put";(n=new V({sliceItem:e,crc32:r,url:o,taskInfor:i,userId:s,retryTime:this.retryUploadTime,method:n})).upload(),n.on("complete",function(e){t.success(e.xhr)}),n.on("error",function(e){t.fail(e.xhr)}),n.on("process",function(e){t.process(e)}),this.uploadHandlers=n}},{key:"success",value:function(t){this.finishArr=[];var e=Date.now()-this._st;e=this._uploadSize/e,t=ot(this.currentCtx,{type:"success",stage:"process",percent:100,extra:{message:"direct upload success"},speed:e,xhr:t,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st,isDirect:!0});this.successProcess(t)}},{key:"fail",value:function(t){var e=this.options.context,r=this.options.key;t=ot(e.tasks[r],{extra:{message:"direct upload error"},type:"error",stage:"direct upload",xhr:t,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st});this.failProcess(t)}},{key:"process",value:function(t){var e=this.currentCtx.fileSize;this.finishSize=t.loaded,this.finishSize>this.lastFinishSize&&(this.lastFinishSize=this.finishSize),t=Math.floor(this.finishSize/e*100*100)/100||0,e=ot(this.currentCtx,{stage:"process",percent:t}),t>this.lastProcessPercent&&100!==t&&(this.lastProcessPercent=t,this.context._broadcast("process",e))}}]),e}(),ut=function(t,e){var r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(r=new Int32Array(r));for(var n=-1^~~e,o=(t=new Uint8Array(t)).length,i=0;i<o;i++)n=r[255&(n^t[i])]^n>>>8;return(-1^n)>>>0},ft=function(t){if(void 0!==t)return function t(e){return e.length<8?t(e="0".concat(e)):e}(Number(t).toString(16))};function lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var pt=function(){function t(e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.file=e,this.successProcess=n,this.failProcess=o,this.sliceLength=r,this.retryTime=0,this.fileSize=e.size,this.crc32Array=[]}return function(t,e,r){e&&lt(t.prototype,e),r&&lt(t,r)}(t,[{key:"start",value:function(){this.readFileCrc32(this.file)}},{key:"readFileCrc32",value:function(t){var e,r=this,n=this.sliceLength,o=t.slice||t.webkitSlice||t.mozSlice,i=new FileReader,s=0,a=0;!function c(){a<t.size&&(a=Math.min(s+n,t.size),104857600<t.size&&t.size-a<=5242880&&(a=t.size)),i.readAsArrayBuffer(o.call(t,s,a)),i.onload=function(n){n=n.target.result,e=ut(n,0),r.crc32Array.push({start:s,end:a,crc32:ft(e),buffer:n}),(s=a)<t.size?c():r.success(r.crc32Array)}}()}},{key:"success",value:function(t){this.successProcess(t)}},{key:"fail",value:function(t,e,r,n){3<=this.retryTime?this.failProcess():(this.readFileCrc32(t,e,r,n),this.retryTime++)}}]),t}();function ht(){return(ht=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var dt=function(){function t(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.context=e.context,this.key=e.key,this.source=e.file,this.file=e.file,this.name=name||this.file.name,this.size=this.file.size||0,this.type=this.file.type||"",this.lastModified=this.file.lastModified,this.sliceLength=y.getFileSliceLength(this.file,r.getSliceFunc),this.config=r}return function(t,e,r){e&&yt(t.prototype,e),r&&yt(t,r)}(t,[{key:"slice",value:function(t,e){var r=this.source.slice||this.source.mozSlice||this.source.webkitSlice;return r?r.call(this.source,t,e,this.type):this.source}},{key:"start",value:function(t,e,r){this.successProcess=e,this.failProcess=r,this._st=Date.now(),this.crc32(this.source,this.sliceLength)}},{key:"crc32",value:function(t,e){var r,n=this;t.size>h?this.sliceFile(t,e,function(t){n.success(t)},function(t){n.fail({message:"get crc32 error: ".concat(JSON.stringify(t))})}):0<t.size&&t.size<=h?(r=new pt(t,e,function(t){n.success(t)},function(t){n.fail({message:"get crc32 error: ".concat(JSON.stringify(t))})}),r.start()):this.fail({message:"get crc32 error: file.length cannot be 0"})}},{key:"sliceFile",value:function(t,e,r,n){for(var o=[],i=e,s=t.size,a=new FileReader,c=t.slice||t.webkitSlice||t.mozSlice,u=0,f=0,l=0;f<s;)f=Math.min(u+i,s),104857600<s&&s-f<=5242880&&(f=s),o.push({start:u,end:f,crc32:0}),u=f;try{!function e(i){u=o[i].start,f=o[i].end,a.readAsArrayBuffer(c.call(t,u,f)),a.onload=function(t){t=t.target.result,l=ft(ut(t,0)),o[i].crc32=l,f===s?r(o):e(o.length-1)},a.onerror=function(t){n(t)}}(0)}catch(t){n(t)}}},{key:"getCrc32Key",value:function(t,e){var r=[];return r.push(e.toString(),t[0].crc32,t[t.length-1].crc32),r.join("_")}},{key:"success",value:function(t){var e=this.context,r=this.key,n=this.file.size,o=this.getCrc32Key(t,n);(e=e.tasks[r])&&this.successProcess(ht(e,{key:r,crc32Array:t,crc32Key:o,sdkVersion:"4.6.1",sliceLength:this.sliceLength,extra:{message:"get crc32 success"},stage:"crc32",type:"success",fileSize:n,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st}))}},{key:"fail",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).message||"get crc32 error",e=this.context,r=this.key;t=ht(e.tasks[r],{extra:{message:t},type:"error",stage:"crc32",sliceLength:this.sliceLength,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st});this.failProcess(t)}}]),t}();function mt(t){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vt(){return(vt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function gt(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _t(t,e){return(_t=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function kt(t){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var wt=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_t(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=kt(t);return function(t,e){return!e||"object"!==mt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=kt(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=t.call(this)).options=r,o.config=n,o.transport=new b,o.eventInit(),o.errorCount=0,o.uploaderCtx=r.context,o.currFileCtx=r.context.tasks[r.key],o}return function(t,e,r){e&&bt(t.prototype,e),r&&bt(t,r)}(e,[{key:"mergeFile",value:function(){for(var t={oid:this.currFileCtx.oid,uploadId:this.currFileCtx.uploadID,tosDomain:this.currFileCtx.tosDomain},e=this.currFileCtx.crc32Array,r="",n=0;n<e.length;n++)r=(r?"".concat(r,","):"").concat(n+1,":").concat(e[n].crc32);var o=y.urlTemplate(this.config.uploadMergeUrl,t);t=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?gt(Object(r),!0).forEach(function(e){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({Authorization:this.currFileCtx.signature,"X-Storage-U":this.config.user_id},this.currFileCtx.tos_headers);this.config.clientEncrypt&&(t["x-upload-encryption-mode"]=2,t["x-upload-encryption-key"]=btoa(this.currFileCtx.clientEncryptKey)),this.transport.send({method:"post",url:o,headers:t,custom:r})}},{key:"start",value:function(t,e,r){this.successProcess=e,this.failProcess=r,this._st=Date.now(),this.mergeFile()}},{key:"eventInit",value:function(){var t=this,e=this.options.stage;this.transport.on("complete",function(r){try{var n=JSON.parse(r.response);0===n.success&&n.payload.key?(vt(t.currFileCtx,{stage:e,type:"success",hasMerge:!0,extra:{message:"merge file success"},xhr:r,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st}),t.successProcess(t.currFileCtx)):t.fail({error:"fail! result.success:".concat(n.success),xhr:r})}catch(n){t.fail({error:"response parse error: ".concat(JSON.stringify(n)),xhr:r})}}),this.transport.on("error",function(e){t.fail({error:"request fail: ".concat(e.statusText||e.errText),xhr:e})})}},{key:"getProcessIndex",value:function(t){var e=0;return t.forEach(function(t,r){"process"===t.stage&&(e=r)}),e}},{key:"fail",value:function(t){t=vt(this.currFileCtx,{extra:{message:"merge file error, ".concat(t.error)},type:"error",stage:this.options.stage,xhr:t.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st}),this.failProcess(t)}}]),e}();function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function St(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ot(Object(r),!0).forEach(function(e){!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ot(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function Pt(){return(Pt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Tt(t,e){return(Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ct(t){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Dt=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tt(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=Ct(t);return function(t,e){return!e||"object"!==xt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=Ct(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=t.call(this)).options=r,o.config=n,o.uploaderCtx=r.context,o.currFileCtx=r.context.tasks[r.key],o.transport=new b,o.eventInit(),o}return function(t,e,r){e&&jt(t.prototype,e),r&&jt(t,r)}(e,[{key:"commitUpload",value:function(){var t=this.options.key,e=this.options.context.tasks[t];t={vid:e.vid,oid:e.oid,token:e.token,poster_ss:this.config.coverTime,is_exact_poster:this.config.isExactCover,user_reference:this.config.user_reference||""};this.currFileCtx.useBackupDomain&&(this.config.replace.vasDomain=this.config.vasBackupDomain),this.transport.send({method:"post",url:"".concat(y.urlTemplate(this.config.getVideoInfoUrl,this.config.replace),"&").concat(e.extra_param||""),headers:{"Content-Type":"application/json","X-TT-Access":this.config.department,Authorization:this.currFileCtx.proxyAuth},custom:t,timeout:3e4})}},{key:"start",value:function(t,e,r){this.successProcess=e,this.failProcess=r,this._st=Date.now(),this.commitUpload()}},{key:"eventInit",value:function(){var t=this;this.transport.on("complete",function(e){try{var r=JSON.parse(e.response);2e3===r.code?(Pt(t.currFileCtx,{stage:"complete",type:"success",percent:100,extra:{message:"get cover success"},video:St(St({},r.data.video),{},{oid:t.currFileCtx.oid,fileType:r.data.file_type}),poster:r.data.poster,xhr:e,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st}),t.successProcess(t.currFileCtx)):t.fail({error:"fail! result.code: ".concat(r.code),errorCode:r.code,message:"get videometa error: ".concat(r.message),xhr:e})}catch(r){t.fail({error:"catch error: ".concat(JSON.stringify(r)),xhr:e})}}),this.transport.on("error",function(e){t.fail({error:"request fail: ".concat(e.statusText||e.errText),xhr:e})})}},{key:"fail",value:function(t){var e=this.options.context,r=this.options.key,n=t.xhr,o=t.errorCode||"",i="prepare upload error: UNKNOWN";n&&(i=0===n.status?"prepare upload error: NETERROR":t.message||"prepare upload error: ".concat(n.status)),n=Pt(e.tasks[r],{extra:{message:i,error:t.error,errorCode:o},type:"error",stage:"complete",xhr:n,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st}),this.failProcess(n)}}]),e}();function Ft(t){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Et(){return(Et=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function Rt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function At(t,e){return(At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ut(t){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var It=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=Ut(t);return function(t,e){return!e||"object"!==Ft(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=Ut(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=t.call(this)).options=r,o.config=n,o.transport=new b,o.uploaderCtx=r.context,o.currFileCtx=r.context.tasks[r.key],o.eventInit(),o}return function(t,e,r){e&&Rt(t.prototype,e),r&&Rt(t,r)}(e,[{key:"initEncrypt",value:function(){var t=this.options.context,e=this.options.key,r={object_type:this.options.type||"video",object_id:t.tasks[e].oid,token:t.tasks[e].token,context:t.tasks[e].context};this.options.encryptOption&&(r.config=this.options.encryptOption.config||{},r.policy_params=this.options.encryptOption.policy_params||{},r.action=this.options.encryptOption.action||"encryption");var n=y.urlTemplate(this.config.getEncryptInfoUrl,this.config.replace);this.transport.send({method:"post",url:n,headers:{"X-TT-Access":this.config.department,Authorization:t.tasks[e].proxyAuth,"Content-Type":"application/json"},custom:r,timeout:3e4})}},{key:"start",value:function(t,e,r){this.successProcess=e,this.failProcess=r,this._st=Date.now(),this.initEncrypt()}},{key:"eventInit",value:function(){var t=this,e=this.options.context,r=this.options.key;this.transport.on("complete",function(n){try{var o,i,s,a=JSON.parse(n.response);2e3===a.code?(o=Et(e.tasks[r],{encryptData:a.data,percent:0,type:"success",extra:{message:"file encryption success"},stage:"complete",xhr:n,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st}),i=a.data.encryption&&a.data.encryption.extra,s=a.data.encryption&&a.data.encryption.object_id,"image"===t.options.type?o.image={meta:{format:i.img_format,height:i.img_height,width:i.img_width,size:i.img_size,frameCnt:i.img_frameCnt,duration:i.img_duration},uri:s}:"video"===t.options.type&&(o.video={meta:{height:i.thumb_height,width:i.thumb_width},uri:s}),t.successProcess(o)):t.fail({error:"fail! result.code: ".concat(a.code),errorCode:a.code,message:"file encryption error: ".concat(a.message),xhr:n})}catch(o){t.fail({error:"response parse error: ".concat(JSON.stringify(o)),xhr:n})}}),this.transport.on("error",function(e){t.fail({error:"request fail: ".concat(e.statusText||e.errText),xhr:e})})}},{key:"fail",value:function(t){var e=this.options.context,r=this.options.key,n=t.xhr,o=t.errorCode||"",i="file encryption error: UNKNOWN";n&&(i=0===n.status?"file encryption error: NETERROR":t.message||"file encryption error: ".concat(n.status)),t=Et(e.tasks[r],{extra:{message:i,error:t.error,errorCode:o},type:"error",stage:"complete",xhr:t.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st}),this.failProcess(t)}}]),e}();function zt(t){return(zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bt(){return(Bt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function Lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mt(t,e){return(Mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Nt(t){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ht=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mt(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=Nt(t);return function(t,e){return!e||"object"!==zt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=Nt(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r){var n,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length?arguments[2]:void 0,s=3<arguments.length?arguments[3]:void 0;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=t.call(this,r)).tasks=r,n.config=o,n.key=s,n.uploaderCtx=i,n.current=0,n.length=n.tasks.length,n.taskError={},n.uploadList=[],n.retryTaskTime=o.retryTaskTime||3,n}return function(t,e,r){e&&Lt(t.prototype,e),r&&Lt(t,r)}(e,[{key:"start",value:function(){var t,e=this.uploaderCtx,r=this.tasks.shift();r&&((t=e.tasks[r.key]).logError&&(e.logger.send(Bt({},t,{type:"error"})),delete t.logError,delete t.isProcessError),this.current=r.index,this.execTask(r))}},{key:"execTask",value:function(t){var e=this,r=t.key,n=this.uploaderCtx,o=n.tasks[r].cacheTask,i=n.taskList[r].length;o&&0<t.index&&t.index<o?this.start():(n.tasks[r].currentTask=t.index,1===n.tasks[r].status&&t&&t.func.call(t.context,t.arg,function(o){var s=n.taskList[r][t.index+1];s&&0!==t.index?n._saveTask(r,{currentTask:s.index,stage:s.stage}):t.index===i-1&&n._removeTaskCache(r),0<e.tasks.length?e.start():n._queueSuccess(r),e.success(o)},function(n){n.xhr&&400<=n.xhr.status?e.fail(n):e.taskError[r]?e.taskError[r]<e.retryTaskTime?(e.taskError[r]++,e.execTask(t)):(n.key=r,e.fail(n)):(e.taskError[r]=1,e.execTask(t))}))}},{key:"addTask",value:function(t){this.tasks.push(t)}},{key:"success",value:function(t){var e;t.xhr&&(e=t.xhr,t.req={url:e.currentUrl,param:e.params},t.res={status:e.status,header:e.getAllResponseHeaders(),body:e.responseText},delete t.xhr),Bt(t,{type:"success"});try{this.uploaderCtx._broadcast(t.stage,t)}catch(t){}this.uploaderCtx.logger.send(t)}},{key:"fail",value:function(t){var e,r=this.uploaderCtx;t.xhr&&(e=t.xhr,t.req={url:e.currentUrl,param:e.params},t.res={status:e.status,header:e.getAllResponseHeaders(),body:e.responseText},t.extra&&(t.extra.req=t.req,t.extra.res=t.res),delete t.xhr),Bt(t,{type:"error"});try{r._broadcast("error",t)}catch(t){}r.tasks[t.key].isBreak?r._cancel(t.key):r._pause(t.key),r.logger.send(t)}},{key:"cancel",value:function(t){var e;t||(e=this.key,t=this.uploaderCtx.tasks[e].currentTask,t=this.uploaderCtx.taskList[e][t],this.tasks=[],t&&3===t.index&&t.context.stop(),this.uploaderCtx._removeTaskCache(e))}},{key:"restart",value:function(){this.uploadList.forEach(function(t){t.cancel=!1}),this.start()}}]),e}();function qt(t){return(qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kt(){return(Kt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function Gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Wt(t,e){return(Wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Jt(t){return(Jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Xt=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wt(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=Jt(t);return function(t,e){return!e||"object"!==qt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=Jt(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=t.call(this)).options=r,o.config=n,o.uploaderCtx=r.context,o.currFileCtx=r.context.tasks[r.key],o.transport=new b,o.eventInit(),o}return function(t,e,r){e&&Gt(t.prototype,e),r&&Gt(t,r)}(e,[{key:"imageInfo",value:function(){var t,e,r=this.options.key,n=this.options.context.tasks[r],o=[{uri:n.oid}];this.options.data&&this.options.data.imageCrop&&(t=this.options.data.imageCrop,r="tplv-l-crop:".concat(t.leftTop[0],":").concat(t.leftTop[1],":").concat(t.rightBottom[0],":").concat(t.rightBottom[1]),Kt(o[0],{general:{param:r,format:t.format||""}})),this.options.data&&this.options.data.imageLogo&&(e=this.options.data.imageLogo,Kt(o[0],{logo_param_v2:{tpl:e.tpl,format:e.format,text:e.text}})),this.options.data&&this.options.data.imageRatio&&(e=this.options.data.imageRatio,Kt(o[0],{ratio_param:e})),o={method:"post",url:"".concat(y.urlTemplate(this.config.getImageInfoUrl,this.config.replace),"&").concat(n.extra_param||""),headers:{"Content-Type":"application/json","X-TT-Access":this.config.department,Authorization:this.currFileCtx.proxyAuth},custom:o,timeout:3e4},this.transport.send(o)}},{key:"start",value:function(t,e,r){this.successProcess=e,this.failProcess=r,this._st=Date.now(),this.imageInfo()}},{key:"eventInit",value:function(){var t=this;this.transport.on("complete",function(e){try{var r=JSON.parse(e.response);2e3===r.code?(Kt(t.currFileCtx,{stage:"complete",type:"success",percent:100,extra:{message:"get image meta success"},image:{meta:r.data[0].info,uri:r.data[0].result_uri},xhr:e,stageStartTime:t._st,stageEndTime:Date.now(),duration:Date.now()-t._st}),t.successProcess(t.currFileCtx)):t.fail({error:"fail! result.code: ".concat(r.code),errorCode:r.code,message:"get imagemeta info error: ".concat(r.message),xhr:e})}catch(r){t.fail({error:"catch error: ".concat(JSON.stringify(r)),xhr:e})}}),this.transport.on("error",function(e){t.fail({error:"request fail: ".concat(e.statusText||e.errText),xhr:e})})}},{key:"fail",value:function(t){var e=this.options.context,r=this.options.key,n=t.xhr,o=t.errorCode||"",i="get imagemeta info error: UNKNOWN";n&&(i=0===n.status?"get imagemeta info error: NETERROR":t.message||"get imagemeta info error: ".concat(n.status)),t=Kt(e.tasks[r],{extra:{message:i,error:t.error,errorCode:o},type:"error",stage:"complete",xhr:t.xhr,stageStartTime:this._st,stageEndTime:Date.now(),duration:Date.now()-this._st}),this.failProcess(t)}}]),e}();function Vt(t){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yt(){return(Yt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function Zt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qt(t,e){return(Qt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $t(t){return($t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var te=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qt(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=$t(t);return function(t,e){return!e||"object"!==Vt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=$t(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=t.call(this)).options=r,o.config=n,o.uploaderCtx=r.context,o.currFileCtx=r.context.tasks[r.key],o}return function(t,e,r){e&&Zt(t.prototype,e),r&&Zt(t,r)}(e,[{key:"start",value:function(t,e){var r=this;setTimeout(function(){Yt(r.currFileCtx,{stage:"complete",type:"success",percent:100,extra:{message:"upload complete and not get metadata"},stageStartTime:Date.now(),stageEndTime:Date.now(),duration:0}),e(r.currFileCtx)},0)}}]),e}();function ee(t){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function re(){return(re=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r,n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function oe(t,e){return(oe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ie(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function se(t){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ae=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oe(t,e)}(e,o.a);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=se(t);return function(t,e){return!e||"object"!==ee(e)&&"function"!=typeof e?ie(t):e}(this,e?(r=se(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=t.call(this,r)).config=re({},a),n._mergeOptions(n.config,r),n.tasks={},n.taskList={},n.cache={},n.storage=y.storage(ie(n)),n.logger=new w(n.config,ie(n)),n}return function(t,e,r){e&&ne(t.prototype,e),r&&ne(t,r)}(e,[{key:"_mergeOptions",value:function(t,e){e&&"object"===ee(e)&&((t.isBOE&&void 0===e.isBOE||e.isBOE)&&e.vasDomain&&(e.vasDomain+=t.topDomain),re(t,e),t.department=e.access_key||e.department||t.department,t.log.user_id=e.user_id||t.user_id,Object.keys(e).forEach(function(r){"vasDomain"===r||"tosDomain"===r||"logDomain"===r?t.replace[r]=e[r]:"access_key"===r?(t.replace.department=e[r],t.log.category_name=e[r]):"department"===r&&(t.replace[r]=e[r],t.log.category_name=e[r])}))}},{key:"_setCache",value:function(t,e){this.storage.setItem(t,e)}},{key:"_getCache",value:function(t){return this.storage.getItem(t)}},{key:"_removeCache",value:function(t){t?this.storage.removeItem&&this.storage.removeItem(t):this.storage.clear&&this.storage.clear()}},{key:"_addTask",value:function(t,e){var r=this.tasks,n=this.taskList;r[t]&&r[t].task?n[t].push(e):(n[t]=[],n[t].push(e),r[t]=r[t]||{},r[t].task=new Ht([],this.config,this,t)),r[t].task.addTask(e)}},{key:"_broadcast",value:function(t,e){var r=this.tasks[e.key].status;if(1===r||0===r)try{this.emit(t,e)}catch(t){if(!(r=!("[object Error]"!==Object.prototype.toString.call(t)))||r&&"Error"===t.name)throw t}}},{key:"_addPreUploadTask",value:function(t,e){var r={file:t.file,context:this,type:t.type,auth:t.auth,objectKey:t.objectKey,preUploadUriParams:t.preUploadUriParams||{},key:e};r={context:r=new(this.config.encrypt||t.type===l?I:C)(r,this.config),func:r.start,arg:{},key:e,index:1,stage:"preUpload"};this._addTask(e,r)}},{key:"_addDirectUploadTask",value:function(t,e){t={context:t=new ct({file:t.file,context:this,key:e},this.config),func:t.start,arg:{},key:e,index:3,stage:"process"},this._addTask(e,t)}},{key:"_addInitUploadIDTask",value:function(t,e){t={context:t=new q({file:t.file,context:this,key:e},this.config),func:t.start,arg:{},key:e,index:2,stage:"initUploadID"},this._addTask(e,t)}},{key:"_addUploadProcessTask",value:function(t,e){t={context:t=new rt({file:t.file,context:this,key:e},this.config),func:t.start,arg:{},key:e,index:3,stage:"process"},this._addTask(e,t)}},{key:"_addCrc32ProcessTask",value:function(t,e){t={context:t=new dt({file:t.file,context:this,key:e},this.config),func:t.start,arg:{},key:e,index:0,stage:"crc32"},this._addTask(e,t)}},{key:"_mergeFileTask",value:function(t,e){t={context:t=new wt({file:t.file,context:this,stage:"fileMerge",key:e},this.config),func:t.start,arg:{},key:e,index:4,stage:"fileMerge"},this._addTask(e,t)}},{key:"_getMetaInfoTask",value:function(t,e){var r={file:t.file,context:this,data:t.data,type:t.type,encryptOption:t.encryptOption||{},key:e},n=new Dt(r,this.config),o=new Xt(r,this.config),i=new It(r,this.config);r=new te(r,this.config),n=this.config.encrypt?i:t.type===l?r:t.type===u?o:n;this.config.noMeta&&(n=r),n={context:n,func:n.start,arg:{},key:e,index:5,stage:"complete"},this._addTask(e,n)}},{key:"_addAllUploadProcess",value:function(t,e){this.tasks[e]=this.tasks[e]||{},this.tasks[e].proxyAuth=t.auth,this.tasks[e].fileSize=t.file&&t.file.size,this.config.clientEncrypt&&(this.tasks[e].clientEncryptKey=y.generateKey(16)),this._addCrc32ProcessTask(t,e),this._addPreUploadTask(t,e),t.file.size<h&&!this.config.clientEncrypt?this._addDirectUploadTask(t,e):(this._addInitUploadIDTask(t,e),this._addUploadProcessTask(t,e),this._mergeFileTask(t,e)),this._getMetaInfoTask(t,e)}},{key:"_run",value:function(t){var e=this.tasks,r=navigator.userAgent.toLowerCase().match(/msie ([\d.]+)/);if(r&&r[1]&&Number(r[1])<=9)return this._broadcast("error",re(e[t],{key:t,status:0,stage:"browserError",extra:{message:"cannot support the browser below ie10"},type:"error"})),this.logger.send(e[t]),void this._cancel(t);e[t]?3===e[t].status?this._restart(t):(r=new Date,e[t].startTime=r.getTime(),e[t].task&&1!==e[t].status&&e[t].task.tasks.length&&(e[t].status=1,this.logger.send(re({},e[t],{extra:{message:"start upload"},type:"success",key:t})),e[t].task.start())):console.warn("".concat(t," is not exit in object tasks, stop running..."))}},{key:"_restart",value:function(t){var e,r,n=this,o=this.tasks;o[t]?(e=o[t].task,r=o[t].currentTask||0,this.taskList[t].forEach(function(o,i){o.index===r&&(e.tasks=n.taskList[t].slice(i))}),e&&1!==o[t].status&&e.tasks.length&&(o[t].status=1,e.restart())):console.warn("".concat(t," is not exit in object tasks"))}},{key:"_cancel",value:function(t){var e=this.tasks;e[t]?(e[t].status=2,e[t].task.cancel(),this.taskList[t]=[]):console.warn("".concat(t," is not exit in object tasks"))}},{key:"_pause",value:function(t){var e=this.tasks;e[t]?(e[t].status=3,e[t].task.cancel(!0),this._saveTask(t)):console.warn("".concat(t," is not exit in object tasks"))}},{key:"_removeTaskCache",value:function(t){var e=this.tasks;e[t]?(e=e[t].crc32Key)&&this._removeCache(e):console.warn("".concat(t," is not exit in object tasks"))}},{key:"_saveTask",value:function(t,e){(e=(t=re({},this.tasks[t],e||{})).crc32Key)&&(delete t.task,delete t.xhr,delete t.crc32Array,this._setCache(e,JSON.stringify(t)))}},{key:"_queueSuccess",value:function(t){var e,r=this.tasks;r[t]?(e=new Date,r[t].endTime=e.getTime(),r[t].time=r[t].endTime-r[t].startTime,r[t].status=0,this.taskList[t]=[]):console.warn("".concat(t," is not exit in object tasks"))}},{key:"_removeFile",value:function(t){delete this.tasks[t]}},{key:"_batchAction",value:function(t){var e=this.tasks;Object.keys(e).forEach(function(e){t&&t(e)})}},{key:"_refreshAuth",value:function(t){var e=this,r=this.tasks;Object.keys(r).forEach(function(n){var o=r[n],i=re({},o,{proxyAuth:t});o.proxyAuth=t,(n=i.crc32Key)&&(delete i.task,delete i.xhr,delete i.crc32Array,o.proxyAuth=t,e._setCache(n,JSON.stringify(i)))})}},{key:"_setOption",value:function(t){this._mergeOptions(this.config,t)}},{key:"_getOption",value:function(t){var e=re({},this.config);return Object.keys(e).forEach(function(t){(-1<t.indexOf("Url")||"replace"===t||"log"===t)&&delete e[t]}),t?e[t]:e}},{key:"_userCancel",value:function(t){var e=this,r=this.tasks;t?(e._cancel(t),e.logger.send(re({},r[t],{type:"cancel"}))):Object.keys(r).forEach(function(t){e._cancel(t),e.logger.send(re({},r[t],{type:"cancel"}))})}},{key:"_userPause",value:function(t){var e=this,r=this.tasks;t?(e._pause(t),e.logger.send(re({},r[t],{type:"pause"}))):Object.keys(r).forEach(function(t){e._pause(t),e.logger.send(re({},r[t],{type:"pause"}))})}}]),e}();function ce(t){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fe(t,e){return(fe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function le(t){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var pe=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fe(t,e)}(e,ae);var t=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n=le(t);return function(t,e){return!e||"object"!==ce(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,e?(r=le(this).constructor,Reflect.construct(n,arguments,r)):n.apply(this,arguments))}}(e);function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.apply(this,arguments)}return function(t,e,r){e&&ue(t.prototype,e),r&&ue(t,r)}(e,[{key:"start",value:function(t){this.abort=!1,t?this._run(t):this._batchAction(this._run.bind(this))}},{key:"addFile",value:function(t){if(t.file){var e=y.getUnique("file");return this._addAllUploadProcess(t,e),e}return null}},{key:"removeFile",value:function(t){t&&this._removeFile(t)}},{key:"cancel",value:function(t){this._userCancel(t)}},{key:"pause",value:function(t){this._userPause(t)}},{key:"restart",value:function(t){t?this._restart(t):this._batchAction(this._restart.bind(this))}},{key:"refreshAuth",value:function(t){this._refreshAuth(t)}},{key:"setOption",value:function(t){this._setOption(t)}},{key:"getOption",value:function(t){return this._getOption(t)}}]),e}()}])})}}]);
//# sourceMappingURL=other-vender-435141e7.65b0b0ecfaaa9af993af.js.map